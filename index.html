<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="现在立刻马上！">
<meta property="og:type" content="website">
<meta property="og:title" content="星空航行家的旅行日志">
<meta property="og:url" content="http://neonmori.github.io/index.html">
<meta property="og:site_name" content="星空航行家的旅行日志">
<meta property="og:description" content="现在立刻马上！">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="星空航行家的旅行日志">
<meta name="twitter:description" content="现在立刻马上！">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://neonmori.github.io/"/>

  <title> 星空航行家的旅行日志 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">星空航行家的旅行日志</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/07/25/KOTOKO-雲雀/" itemprop="url">
                  KOTOKO - 雲雀
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2018-07-25T11:05:56-07:00" content="2018-07-25">
              2018-07-25
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="雲雀"><a href="#雲雀" class="headerlink" title="雲雀"></a>雲雀</h1><p>作詞：KOTOKO<br>作曲：KOTOKO</p>
<p>翻訳：neonmori</p>
<p>ひび割れ泣く乾いた枝にもう終わりだと風が吹き || 龟裂哭泣的那干枯枝桠 随着风的吹蚀使命已经终结<br>競い合うように芽吹いた葉たち　ただ無言のまましがみつく || 竞相绽出新芽的叶片们 只是相顾无言紧紧抓住着最后的依靠</p>
<p>現実とはこんなもの…と || 现实似乎就是如此残酷的… 心里这样想着<br>行き交う人ごみの中で掠れてく || 从川流不息的人群中掠过</p>
<p>気付いて　僕はここにいるよ || 注意到了吗 我就在这里<br>枯れてなんかいないよ || 并没有枯萎<br>顔のない影たちが並ぶ渋滞 || 没有面容的影子们拥挤堵塞<br>どこに誰と行けば… || 是要急着去哪里和谁相会？<br>どんな言葉選んだら… || 是想着要选择怎样的甜言蜜语？<br>雲雀の声が遠くなってく || 云雀的声音逐渐远去<br>生きてるのは誰のため？ || 而活着是为了谁？<br>僅かな称賛もらうため？ || 只是为了获得那少的可怜的称赞吗？<br>頷けないよ || 别急着点头赞同<br>僕はまだ解ってない || 我也还没有找到着问题的解答<br>空っ風　真実を言ってよ || 越山而来的冷风啊 在对我诉说着真相</p>
<p>屋上から覗いた街に　また暖かい風が吹き || 从屋顶上窥见的街道上 又开始刮起了暖风<br>ひと時でも背を向けると　ほら　二度ともう戻れない || 假如片刻背过身去 我也不会再回来了</p>
<p>画面の中の無数の文字が || 画面中无数的文字<br>意味ない点の塊に変わるだけ || 变成了没有意义的点阵组成的方块</p>
<p>教えて　僕はどこにいるの？ || 告诉我吧 身在何处<br>本当は何がしたいの？ || 想做什么<br>声のない影たちが叫ぶ劇場 || 无声的暗影们啸叫的剧场<br>こんな小さな箱に || 在这样一个小小的箱子中<br>何もかもが支配され || 被人完全支配着<br>いつか空もいらなくなった || 不知何时开始不再需要天空<br>小さな羽　もらったのに || 明明我还有那小小的翅膀<br>飛べなくなったのは誰のせい？ || 却无法再翱翔蓝天是因为谁的缘故？<br>生まれたままで居られたら良かったのに || 明明只要如同初生时自由自在的活着就好<br>黙ってた頬に雨が降る || 冷冷的雨落在沉默的面颊上</p>
<p>この灰色の柵を乗り越え || 越过这灰色的栅栏<br>思いっきり今　広い空へ飛び出したら || 心里所想的 都是飞向那广阔的天空<br>春を追いかける雲雀のように || 如同那追逐春天的云雀一般<br>囀り歌えるかな？　上手く飛べるかな？ || 还能唱出欢快的歌吗？ 还能自在的飞翔吗？<br>誰か答えて… || 谁来给我一个答案吧</p>
<p>僕はここにいるよ || 我就在这里<br>枯れてなんかいないよ || 并没有枯萎<br>顔のない影たちが並ぶ渋滞 || 没有面容的影子们拥挤堵塞<br>どこに誰と行けば… || 是要急着去哪里和谁相会？<br>どんな言葉選んだら… || 是想着要选择怎样的甜言蜜语？<br>雲雀は今日も空で歌う || 云雀今天也在空中歌唱<br>生きてるのは誰のため？ || 而活着是为了谁？<br>僅かな愛情　探すため？ || 只是为了寻找那微不足道的爱情吗？<br>言わなくていいよ || 不要再说下去了<br>神様も解ってない || 这是个连神明也不会解答的问题<br>ただ青い惑星(ほし)がまわってる || 只要这蓝色的行星还在转动</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/07/24/KOTOKO-夏恋/" itemprop="url">
                  KOTOKO - 夏恋
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2018-07-24T17:45:32-07:00" content="2018-07-24">
              2018-07-24
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="夏恋"><a href="#夏恋" class="headerlink" title="夏恋"></a>夏恋</h1><p>作詞：KOTOKO<br>作曲：KOTOKO</p>
<p>翻訳：neonmori</p>
<p>ためらうように伸ばす指がふっと || 犹豫迟疑着伸出去的手指突然间<br>あと少しの距離で止まる || 在还有小小距离的时候停了下来<br>君はまた小さなため息だけ残して || 你只留下那一声轻浅的叹息<br>雲を見ていた || 抬头注视着天上的云</p>
<p>言葉より || 比起千言万语<br>ただ側に居て欲しくて || 只想要陪伴在你身边<br>永遠みたいな沈黙を引き寄せて || 在这好似时光永远无尽的沉默中彼此靠近<br>強く抱きしめた || 紧紧拥抱在一起</p>
<p>空へ伸びてく入道雲 || 向空中无限延伸的积雨云<br>どうか消えないで || 请永远不要消失<br>焼け付く草原 || 好似熊熊燃烧的草原<br>二人ただコントラストの中にいた || 我们两人存在于这巨大的天地碰撞中<br>近づいて行く二つの指先 || 不断靠近的两个指尖<br>夏が焦がしてく || 渐渐被夏天炙烤融化<br>白い逆光の中　浮かぶシルエット || 在白色的逆光中 浮现出来的那两道剪影<br>陽炎が揺らした || 让热雾也为之动摇</p>
<p>切り取ったノートの端 || 从笔记本上剪下的那张字条<br>そっと“好き”って言葉だけを書いて || 轻轻的笔触只写着”我喜欢你“<br>閉じ込めた || 被禁锢在其中的我们<br>なんで出会いは順番通りに来てくれないの？ || 为什么相遇这件事无法按部就班？</p>
<p>吹き付けた夏風 || 迎面吹来的夏风<br>その熱さで || 那份炎热<br>涙と凍らせてた視線まで || 连眼泪与凝固的视线<br>溶けて零れた || 都能融化蒸发</p>
<p>走り出す背中押す青空 || 推着我们向前奔跑的那片蓝天<br>どうか止めないで || 请不要停下来<br>二人はきっと同じだと || 你一定和我一样<br>あの日気付いてしまった || 注意到了那一天<br>濡らした頬　笑い拭う太陽 || 将脸颊上的汗珠 笑着擦掉的太阳<br>今はここに居て || 现在 就在这里的我<br>夏は悲しいくらいに光を集めて || 只能可悲的将夏天的光收集起来<br>二人の影　隠すよ || 把两个人的影子藏起来</p>
<p>大きくなってく入道雲 || 逐渐扩大的那片积雨云<br>どうかこのままで || 就请你将一切定格<br>溢れ出した想いはもう || 心中溢出的思念已经无处安放<br>焼けた夏のせいじゃないね || 全然并非因为这灼人的夏天<br>廻(めぐ)る季節が繋げた指先 || 不断轮回的季节<br>もうほどけないね || 已经无法解开我们紧紧交握的十指<br>白い逆光の中　揺れたシルエット || 在白色的逆光中 浮现出来的那两道剪影<br>一つに重なった || 已经重合在一起</p>
<p>君は今も胸に… || 你现在心中也是…</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/30/理解Kotlin中的泛型与变体/" itemprop="url">
                  理解Kotlin中的泛型与变体
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2017-07-30T23:12:00-07:00" content="2017-07-30">
              2017-07-30
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="理解Kotlin中的泛型与变体"><a href="#理解Kotlin中的泛型与变体" class="headerlink" title="理解Kotlin中的泛型与变体"></a>理解Kotlin中的泛型与变体</h1><p><a href="https://proandroiddev.com/understanding-generics-and-variance-in-kotlin-714c14564c47" target="_blank" rel="noopener">原文</a> by <a href="https://proandroiddev.com/@tpolansk?source=user_popover" target="_blank" rel="noopener">Tomek Polański</a></p>
<p>在面向对象编程语言中，一个重要的卖点就是<em>继承</em>。</p>
<p>它允许我们进行诸如将一个子类的实例赋值到一个超类变量上：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer integer = <span class="keyword">new</span> Integer(<span class="number">1</span>);</span><br><span class="line">Number number = interger;</span><br></pre></td></tr></table></figure>
<p>多亏了这个特性，我们可以更加抽象地编写代码，比如声明一个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printNumber</span><span class="params">(Number number)</span></span></span><br></pre></td></tr></table></figure>
<p>而这个方法可以接受两种类型：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">printNumber(integer);</span><br><span class="line">printNumber(number);</span><br></pre></td></tr></table></figure>
<p>不幸的是，在Java中的泛型不总是简洁明了的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; integerList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">List&lt;Number&gt; numberList = integerList; <span class="comment">// Compiler Error</span></span><br></pre></td></tr></table></figure>
<hr>
<p>要真正理解泛型，首先我们需要理解这三个主要概念：</p>
<ul>
<li><strong>类</strong> 与 <strong>类型</strong></li>
<li><strong>子类</strong> 与 <strong>子类型</strong></li>
<li>变体：<strong>协变</strong>、<strong>逆变</strong>与<strong>不变</strong></li>
</ul>
<h2 id="类与类型"><a href="#类与类型" class="headerlink" title="类与类型"></a>类与类型</h2><p>你或许从来没有想过类与类型是两种不同的概念。</p>
<p>在Java和Kotlin中，所有类都有至少一个与它自身相同的类型，比如一个<code>Integer</code>就同时是一个类也是一个类型。</p>
<p>从另一个方面来说，在Kotlin中我们也有可空类型，比如<code>String?</code>；我们不能说<code>String?</code>是一个类，因为从表面来看，它依旧是一个<code>String</code>字符串。</p>
<p>Java和Kotlin中还能举出另一个例子。<code>List</code>是一个类，但<code>List&lt;String&gt;</code>就不是一个类，而是一个类型。</p>
<p>我们用下面的表格对上面的两个例子进行一下总结：</p>
<table>
<thead>
<tr>
<th></th>
<th>类</th>
<th>类型</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>String</code></td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td><code>String?</code></td>
<td><strong>不是</strong></td>
<td>是</td>
</tr>
<tr>
<td><code>List</code></td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td><code>List&lt;String&gt;</code></td>
<td><strong>不是</strong></td>
<td>是</td>
</tr>
</tbody>
</table>
<h2 id="子类与子类型"><a href="#子类与子类型" class="headerlink" title="子类与子类型"></a>子类与子类型</h2><p>一个子类需要继承自另一个类。比如，<code>Integer</code>继承自<code>Number</code>，所以<code>Integer</code>是<code>Number</code>的子类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph BT</span><br><span class="line">A[Integer] ==&gt; B[Number]</span><br></pre></td></tr></table></figure>
<p>这也意味着我们可以进行下面的赋值：</p>
<p>Java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer integer = <span class="keyword">new</span> Integer(<span class="number">1</span>);</span><br><span class="line">Number number = integer;</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> integer: <span class="built_in">Int</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">val</span> number: Number = integer</span><br></pre></td></tr></table></figure>
<p>这些操作之所以能够实现是因为<code>Integer</code>是<code>Number</code>的<strong>子类型</strong>。</p>
<p>现在我们换成可空类型来试一下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> integer: <span class="built_in">Int</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">val</span> nummableInteger: <span class="built_in">Int</span>? = integer;</span><br></pre></td></tr></table></figure>
<p>在这里<code>Int</code>是可空类型<code>Int?</code>的<strong>子类型</strong>，所以我们可以把<code>Int</code>赋值给<code>Int?</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph BT</span><br><span class="line">A[Int] ==&gt; B[Int?]</span><br></pre></td></tr></table></figure>
<h2 id="变体"><a href="#变体" class="headerlink" title="变体"></a>变体</h2><p>首先让我们来定义几个Kotlin类：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>(<span class="keyword">val</span> size: <span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span>(<span class="keyword">val</span> cuteness: <span class="built_in">Int</span>): Animal(<span class="number">100</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Spider</span></span>(<span class="keyword">val</span> terrorFactor: <span class="built_in">Int</span>): Animal(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">graph BT</span><br><span class="line">A[Dog] ==&gt; B[Animal]</span><br><span class="line">C[Spider] ==&gt; B</span><br></pre></td></tr></table></figure>
<p>现在让我们来检查一下<code>Dog</code>和<code>Spider</code>是不是<code>Animal</code>的<strong>子类型</strong>：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> dog: Dog = Dog(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">val</span> spider: Spider = Spider(<span class="number">9000</span>)</span><br><span class="line"><span class="keyword">val</span> animal: Animal = dog</span><br><span class="line">animal = spider</span><br></pre></td></tr></table></figure>
<p>完美运行：没有编译错误。自己试一下吧！</p>
<h2 id="协变"><a href="#协变" class="headerlink" title="协变"></a>协变</h2><p>让我们来把这些类型用泛型的<code>List</code>包装一下制造一些更复杂的类型：</p>
<p>一个需要记住的地方在于这个<code>List</code>是Kotlin中的不可变列表：一旦创建之后其中的内容就不可以被修改。很快你就会明白为什么这很重要了。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> dogList: List&lt;Dog&gt; = listOf(Dog(<span class="number">10</span>), Dog(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">val</span> animalList: List&lt;Animal&gt; = dogList</span><br></pre></td></tr></table></figure>
<p>变体告诉我们<code>List&lt;Dog&gt;</code>和<code>List&lt;Animal&gt;</code>之间的关系和<code>Dog</code>与<code>Animal</code>间的关系一样是<strong>子类型</strong>关系。</p>
<p>在Kotlin中，<code>dogList</code>可以被赋值给<code>Animal</code>类型的<code>List</code> (<code>val animalList: List&lt;Animal&gt; = dogList</code>)，所以类型关系被<strong>保留</strong>了，并且<code>List&lt;Dog&gt;</code>是<code>List&lt;Animal&gt;</code>的<strong>子类型</strong>。这就是<strong>协变</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">graph BT</span><br><span class="line">A[Dog] ==&gt; B[Animal]</span><br><span class="line">C[&quot;List&amp;lt;Dog&amp;gt;&quot;] ==&gt; D[&quot;List&amp;lt;Animal&amp;gt;&quot;]</span><br></pre></td></tr></table></figure>
<h2 id="不变"><a href="#不变" class="headerlink" title="不变"></a>不变</h2><p>在Java中，即使<code>Dog</code>是<code>Animal</code>的子类型，你也不能这样做：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Dog&gt; dogList= <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">List&lt;Animal&gt; animalList = dogList; <span class="comment">// Compiler error</span></span><br></pre></td></tr></table></figure>
<p>这是因为Java中的泛型类会忽略它的构件之间的<strong>类型／子类型</strong>关系。在这个例子中，<code>List&lt;Dog&gt;</code>不能被赋值给<code>List&lt;Animal&gt;</code>，反之亦然， 而这就被称为<strong>不变</strong>。这里就没有了<strong>子类型</strong>或是<strong>超类型</strong>的关系。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">graph BT</span><br><span class="line">A[Dog] ==&gt; B[Animal]</span><br><span class="line">C[&quot;List&amp;lt;Dog&amp;gt;&quot;] -.NOT RELATED.- D[&quot;List&amp;lt;Animal&amp;gt;&quot;]</span><br></pre></td></tr></table></figure>
<h2 id="逆变"><a href="#逆变" class="headerlink" title="逆变"></a>逆变</h2><p>或许我们想要比较<code>Animal</code>实例，这也就是为什么我们创造了一个接口<code>interface Compare&lt;T&gt;</code>，和一个元方法<code>compare(T item1, T item2)</code>，这个方法可以判断两个对象的先后次序。</p>
<p>无论何时我们要通过可爱度来比较🐶的时候，我们可以这样实现这个接口：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> dogCompare:Compare&lt;Dog&gt; = <span class="keyword">object</span>: Compare&lt;Dog&gt; &#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">compare</span><span class="params">(first: <span class="type">Dog</span>, second: <span class="type">Dog</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> first.cuteness - second.cuteness</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是如果你尝试将这个狗狗比较器赋值給一个动物比较器的话：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> animalCompare: Compare&lt;Animal&gt; = dogCompare <span class="comment">// Compiler Error</span></span><br></pre></td></tr></table></figure>
<p>这段代码出错的一个好处是：如果可以这样赋值的话，那么我们也可以用这个比较器来比较蜘蛛的可怕度， 但是这样就会出错，因为狗狗比较器只能用来比较狗狗而不是蜘蛛。</p>
<p>换个角度来说，如果我们要比较所有动物的话，那么需要一个能够同时衡量狗狗和蜘蛛的机制：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> animalCompare: Compare&lt;Animal&gt; = <span class="keyword">object</span>: Compare&lt;Animal&gt; &#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">compare</span><span class="params">(first: <span class="type">Animal</span>, second: <span class="type">Animal</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> first.size — second.size</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">val</span> spiderCompare: Compare&lt;Spider&gt; = animalCompare <span class="comment">// Works nicely!</span></span><br></pre></td></tr></table></figure>
<p>我们可以看到<code>Spider</code>是<code>Animal</code>的<strong>子类型</strong>，但是<code>Compare&lt;Animal&gt;</code>却成为了<code>Compare&lt;Spider&gt;</code>的<strong>子类型</strong>——在这里，类型关系发生了<strong>反转</strong>。这一种关系也被称为<strong>逆变</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">graph BT</span><br><span class="line">A[Spider] ==&gt; B[Animal]</span><br><span class="line">C[&quot;List&amp;lt;Animal&amp;gt;&quot;] ==&gt; D[&quot;List&amp;lt;Spider&amp;gt;&quot;]</span><br></pre></td></tr></table></figure>
<h2 id="Java与Kotlin"><a href="#Java与Kotlin" class="headerlink" title="Java与Kotlin"></a>Java与Kotlin</h2><p>多亏了Java，我们可以声明泛型的协变与逆变。</p>
<h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><p>要声明一个<strong>协变</strong>的泛型类型，你只需要：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Dog&gt; dogs = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">List&lt;? extends Animal&gt; animals = dogs;</span><br></pre></td></tr></table></figure>
<p><code>extends</code>关键字将动物列表与狗狗列表之间的关系声明为了<strong>协变</strong>。</p>
<p>需要<strong>逆变</strong>的时候，只需：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Compare&lt;Animal&gt; animalCompare = (first, second) -&gt; first.getSize() - second.getSize();</span><br><span class="line">Compare&lt;? <span class="keyword">super</span> Spider&gt; spiderCompare = animalCompare;</span><br></pre></td></tr></table></figure>
<p><code>super</code>关键字将动物比较器与蜘蛛比较器之间的关系声明为了<strong>逆变</strong>。</p>
<p>这种在使用时创建泛型变体的用法叫做<strong>调用处变体</strong>。</p>
<h2 id="Kotlin"><a href="#Kotlin" class="headerlink" title="Kotlin"></a>Kotlin</h2><p>在Kotlin中并没有什么魔法，它也提供了为泛型声明<strong>协变</strong>与<strong>逆变</strong>的途径。</p>
<h3 id="Out关键字"><a href="#Out关键字" class="headerlink" title="Out关键字"></a>Out关键字</h3><p>如果你浏览过Kotlin的不变列表的定义，你会发现：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">List</span>&lt;<span class="type">out E</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">get</span><span class="params">(index: <span class="type">Int</span>)</span></span>: E</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个<code>out</code>关键字表示这个<code>List</code>接口中的方法只能返回类型<code>E</code>并且不能接受<code>E</code>类型作为泛型参数。</p>
<p>这个限制使得<code>List</code>获得了<strong>协变</strong>能力。</p>
<h3 id="In关键字"><a href="#In关键字" class="headerlink" title="In关键字"></a>In关键字</h3><p>当你查看Kotlin中<code>Compare</code>接口的定义，你会有不一样的发现：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Compare</span>&lt;<span class="type">in T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">compare</span><span class="params">(first: <span class="type">T</span>, second: <span class="type">T</span>)</span></span>: <span class="built_in">Int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里，泛型参数前面多了一个<code>in</code>关键字。</p>
<p>这意味着<code>Compare</code>接口下所有的方法都可以使用<code>T</code>作为泛型参数但是不能返回T类型。</p>
<p>这个限制使得<code>Compare</code>获得了<strong>逆变</strong>能力。</p>
<p>在Kotlin中，泛型变体的问题是编写类声明的开发者需要考虑的问题，而不应该丢给使用这些代码的程序员。这也就是为什么这个机制被称为<strong>声明处变体</strong>的原因。</p>
<hr>
<table>
<thead>
<tr>
<th></th>
<th>协变</th>
<th>逆变</th>
<th>不变</th>
</tr>
</thead>
<tbody>
<tr>
<td>目的</td>
<td>生产者</td>
<td>消费者</td>
<td>生产者+消费者</td>
</tr>
<tr>
<td>例子</td>
<td>ImmutableList</td>
<td>Compare</td>
<td>MutableList</td>
</tr>
<tr>
<td>Java</td>
<td>extends</td>
<td>super</td>
<td></td>
</tr>
<tr>
<td>Kotlin</td>
<td>out</td>
<td>in</td>
</tr>
</tbody>
</table>
<hr>
<p>现在你应该已经知道了你需要声明什么样的泛型类了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/01/CSON的Pegex语法解析/" itemprop="url">
                  CSON的Pegex语法解析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-09-01T20:42:02-07:00" content="2016-09-01">
              2016-09-01
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%grammar cson</span><br><span class="line">%version <span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span></span><br><span class="line">%include pegex-atoms</span><br></pre></td></tr></table></figure>
<p>文档的开头就是定义名称，版本和包含<code>pegex-atoms</code>预定义的规则</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cson: TERMINATOR? - toplevelBlock?</span><br><span class="line"></span><br><span class="line">toplevelBlock: value TERMINATOR?</span><br><span class="line"></span><br><span class="line">value:</span><br><span class="line">  | null</span><br><span class="line">  | booleanLiteral</span><br><span class="line">  | numberLiteral</span><br><span class="line">  | stringLiteral</span><br><span class="line">  | arrayLiteral</span><br><span class="line">  | objectLiteral</span><br><span class="line">  | implicitObjectLiteral</span><br></pre></td></tr></table></figure>
<p>cson文档都由一个值组成，可以是空文件，也可以是<code>null</code>，布尔值，数字，字符串，数组或是对象。<br>在pegex的语法中，<code>-</code>代表任意多（可以为零）个空白字符，而<code>+</code>代表至少有一个空白字符。</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id: <span class="regexp">/ [ DOLLAR ALPHAS UNDER ][ DOLLAR WORDS ]* /</span></span><br></pre></td></tr></table></figure>
<p>对象成员名可以是字符串或是这里定义的<code>id</code>类型：<code>$, _, 0~9, A~Z, a~z</code>，只要是在coffeescript/javascript中合法的变量名都可以用在这里。</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">numberLiteral:</span><br><span class="line">  | <span class="string">'0b'</span> binaryBit+</span><br><span class="line">  | <span class="string">'0o'</span> octalDigit+</span><br><span class="line">  | <span class="string">'0x'</span> hexDigit+</span><br><span class="line">  | decimalNumber</span><br><span class="line"></span><br><span class="line">decimalNumber: <span class="regexp">/(</span></span><br><span class="line"><span class="regexp">  DASH?</span></span><br><span class="line"><span class="regexp">  (: '0' | [1-9] DIGIT* )</span></span><br><span class="line"><span class="regexp">  (: DOT DIGIT* )?</span></span><br><span class="line"><span class="regexp">  (: [eE] [ DASH PLUS ]? DIGIT+ )?</span></span><br><span class="line"><span class="regexp">)/</span></span><br><span class="line"></span><br><span class="line">decimalDigit: <span class="regexp">/[0-9]/</span></span><br><span class="line">hexDigit: <span class="regexp">/[0-9a-fA-F]/</span></span><br><span class="line">octalDigit: <span class="regexp">/[0-7]/</span></span><br><span class="line">binaryBit: <span class="regexp">/[01]/</span></span><br></pre></td></tr></table></figure>
<p>数字值，cson可以使用二进制，八进制和十六进制表示整数。</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">booleanLiteral:</span><br><span class="line">  | (TRUE | YES | ON)</span><br><span class="line">  | (FALSE | NO | OFF)</span><br><span class="line"></span><br><span class="line">null: <span class="string">'null'</span></span><br></pre></td></tr></table></figure>
<p>布尔值可以用<code>true, yes, on</code>表示真值，<code>false, no, off</code>表示伪值。</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">stringLiteral:</span><br><span class="line">  | <span class="string">'"""'</span> (stringData | SINGLE | (DOUBLE DOUBLE? !DOUBLE))+ <span class="string">'"""'</span></span><br><span class="line">  | <span class="regexp">/ SINGLE SINGLE SINGLE /</span></span><br><span class="line">    (stringData | DOUBLE | <span class="string">'#'</span> | ( SINGLE? !SINGLE))+</span><br><span class="line">    / SINGLE SINGLE SINGLE /</span><br><span class="line">  | <span class="string">'"'</span> (stringData | SINGLE)* <span class="string">'"'</span></span><br><span class="line">  | SINGLE (stringData | <span class="string">'"'</span> | <span class="string">'#'</span>)* SINGLE</span><br><span class="line"></span><br><span class="line">stringData:</span><br><span class="line"><span class="comment">#   | [^"'\\#]</span></span><br><span class="line">  | UnicodeEscapeSequence</span><br><span class="line">  | <span class="string">'\x'</span> (hexDigit hexDigit)</span><br><span class="line">  | <span class="string">'\0'</span> !decimalDigit</span><br><span class="line">  | <span class="string">'\0'</span> =decimalDigit</span><br><span class="line">  | <span class="string">'\b'</span></span><br><span class="line">  | <span class="string">'\t'</span></span><br><span class="line">  | <span class="string">'\n'</span></span><br><span class="line">  | <span class="string">'\v'</span></span><br><span class="line">  | <span class="string">'\f'</span></span><br><span class="line">  | <span class="string">'\r'</span></span><br><span class="line">  | <span class="string">'\' DOT</span></span><br><span class="line"><span class="string">  | '</span><span class="comment">#' !LCURLY</span></span><br><span class="line"></span><br><span class="line">UnicodeEscapeSequence: <span class="regexp">/ BACK 'u' hexDigit&#123;4&#125; /</span></span><br></pre></td></tr></table></figure>
<p>字符串支持<code>&quot;&quot;&quot;</code>或者<code>&#39;&#39;&#39;</code>包围的多行字符串。</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ws: <span class="regexp">/(: whitespace+ (: blockComment whitespace+ )? )/</span></span><br><span class="line"></span><br><span class="line">comment: blockComment | singleLineComment</span><br><span class="line"></span><br><span class="line">singleLineComment: <span class="string">'#'</span> (!TERM ANY)*</span><br><span class="line"></span><br><span class="line">blockComment: <span class="regexp">/(:</span></span><br><span class="line"><span class="regexp">HASH HASH HASH</span></span><br><span class="line"><span class="regexp">  [^ HASH ] ([^ HASH ] | HASH HASH? (! HASH ))*</span></span><br><span class="line"><span class="regexp">HASH HASH HASH</span></span><br><span class="line"><span class="regexp">)/</span></span><br><span class="line"></span><br><span class="line">whitespace: <span class="regexp">/ WS /</span></span><br></pre></td></tr></table></figure>
<p>cson支持一个<code>#</code>开头的单行注释和被一对<code>###</code>包围的多行注释。</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">INDENT: + <span class="comment">#XXXXX /\uEFEF/</span></span><br><span class="line"></span><br><span class="line">DEDENT: (TERMINATOR? -) <span class="comment">#XXXXX /\uEFFE/</span></span><br><span class="line"></span><br><span class="line">TERM: <span class="regexp">/ (: CR? NL ) /</span></span><br><span class="line"><span class="comment">#   | /\uEFFF/</span></span><br><span class="line"></span><br><span class="line">TERMINATOR: (- comment? TERM blockComment?)+</span><br><span class="line"></span><br><span class="line">TERMINDENT: TERMINATOR INDENT</span><br></pre></td></tr></table></figure>
<p>缩进处理的规则。</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">arrayLiteral:</span><br><span class="line">  <span class="string">'['</span> arrayLiteralBody TERMINATOR? - <span class="string">']'</span></span><br><span class="line"></span><br><span class="line">arrayLiteralBody:</span><br><span class="line">  | TERMINDENT arrayLiteralMemberList DEDENT</span><br><span class="line">  | - arrayLiteralMemberList?</span><br><span class="line"></span><br><span class="line">arrayLiteralMemberList:</span><br><span class="line">  arrayLiteralMember -</span><br><span class="line">  (arrayLiteralMemberSeparator - arrayLiteralMember -)*</span><br><span class="line">  arrayLiteralMemberSeparator?</span><br><span class="line"></span><br><span class="line">arrayLiteralMember:</span><br><span class="line">  | value</span><br><span class="line">  | TERMINDENT implicitObjectLiteral DEDENT</span><br><span class="line"></span><br><span class="line">arrayLiteralMemberSeparator:</span><br><span class="line">  | (TERMINATOR - COMMA?)</span><br><span class="line">  | (<span class="string">','</span> TERMINATOR? -)</span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> fix this:</span></span><br><span class="line"><span class="comment"># (DEDENT ',' TERMINDENT)</span></span><br></pre></td></tr></table></figure>
<p>数组语法的处理</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">objectLiteral:</span><br><span class="line">  <span class="string">'&#123;'</span> objectLiteralBody TERMINATOR? - <span class="string">'&#125;'</span></span><br><span class="line"></span><br><span class="line">objectLiteralBody:</span><br><span class="line">  | TERMINDENT objectLiteralMemberList DEDENT</span><br><span class="line">  | - objectLiteralMemberList?</span><br><span class="line"></span><br><span class="line">objectLiteralMemberList:</span><br><span class="line">  objectLiteralMember -</span><br><span class="line">  (objectLiteralMemberSeparator - objectLiteralMember -)*</span><br><span class="line">  COMMA?</span><br><span class="line"></span><br><span class="line">objectLiteralMemberSeparator: arrayLiteralMemberSeparator</span><br><span class="line"></span><br><span class="line">objectLiteralMember:</span><br><span class="line">  | implicitObjectLiteralMember</span><br><span class="line">  | ObjectInitialiserKeys</span><br><span class="line"></span><br><span class="line">ObjectInitialiserKeys:</span><br><span class="line">  | id</span><br><span class="line">  | string</span><br><span class="line">  | Numbers</span><br><span class="line"></span><br><span class="line">implicitObjectLiteral:</span><br><span class="line">  implicitObjectLiteralMemberList</span><br><span class="line"></span><br><span class="line">implicitObjectLiteralMemberList:</span><br><span class="line">  implicitObjectLiteralMember</span><br><span class="line">  (implicitObjectLiteralMemberSeparator implicitObjectLiteralMember)*</span><br><span class="line"></span><br><span class="line">implicitObjectLiteralMemberSeparator:</span><br><span class="line">  | TERMINATOR COMMA? -</span><br><span class="line">  | - <span class="string">','</span> TERMINATOR? -</span><br><span class="line"></span><br><span class="line">implicitObjectLiteralMember:</span><br><span class="line">  ObjectInitialiserKeys - <span class="string">':'</span> - implicitObjectLiteralMemberValue</span><br><span class="line"></span><br><span class="line">implicitObjectLiteralMemberValue:</span><br><span class="line">  | singleLineImplicitObjectLiteral</span><br><span class="line">  | value</span><br><span class="line">  | TERMINDENT value DEDENT</span><br><span class="line"></span><br><span class="line">singleLineImplicitObjectLiteral:</span><br><span class="line">  singleLineImplicitObjectLiteralMemberList</span><br><span class="line"></span><br><span class="line">singleLineImplicitObjectLiteralMemberList:</span><br><span class="line">  implicitObjectLiteralMember</span><br><span class="line">  (</span><br><span class="line">    singleLineImplicitObjectLiteralMemberSeparator</span><br><span class="line">    implicitObjectLiteralMember</span><br><span class="line">  )*</span><br><span class="line"></span><br><span class="line">singleLineImplicitObjectLiteralMemberSeparator: - <span class="string">','</span> -</span><br><span class="line"></span><br><span class="line">keyValueSeparator:</span><br><span class="line">  | - <span class="string">'=&gt;'</span> -</span><br><span class="line">  | - <span class="string">'|&gt;'</span> -</span><br><span class="line">  | - <span class="string">':='</span> -</span><br><span class="line">  | - <span class="string">':'</span>  -</span><br><span class="line">  | - <span class="string">'='</span>  -</span><br><span class="line"></span><br><span class="line">TRUE: <span class="regexp">/'true' (! identifierPart )/</span></span><br><span class="line">YES: <span class="regexp">/'yes' (! identifierPart )/</span></span><br><span class="line">ON: <span class="regexp">/'on' (! identifierPart )/</span></span><br><span class="line"></span><br><span class="line">FALSE: <span class="regexp">/'false' (! identifierPart )/</span></span><br><span class="line">NO: <span class="regexp">/'no' (! identifierPart )/</span></span><br><span class="line">OFF: <span class="regexp">/'off' (! identifierPart )/</span></span><br><span class="line"></span><br><span class="line">identifierPart: <span class="regexp">/(: [$_] | UnicodeEscapeSequence)/</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/28/KSON格式的想法/" itemprop="url">
                  KSON格式的想法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-08-28T13:24:11-07:00" content="2016-08-28">
              2016-08-28
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最近写的程序多了之后，发现配置文件格式的选择确实是一个问题。Java生态圈对properties格式和XML格式的偏爱，JavaScript圈子里JSON的至高地位，还有语法标准多到令人发指的YAML以及最近在go和rust平台上大放异彩的TOML，可以说各有所长，也都殊途同归（都可以转换成JSON）。</p>
<h4 id="XML的冗长繁杂"><a href="#XML的冗长繁杂" class="headerlink" title="XML的冗长繁杂"></a>XML的冗长繁杂</h4><p>要说起标记语言的发端，XML肯定不能少。但是XML要表示一个字段至少要有一个开始一个结束标记，而且两者要对称，这样一下子就增加了一倍的文本量，绝对算不上轻量。</p>
<h4 id="JSON的不善变通"><a href="#JSON的不善变通" class="headerlink" title="JSON的不善变通"></a>JSON的不善变通</h4><p>JSON在WEB时代真是混的风生水起，基本上所有的语言都支持JSON，而且JSON也确实对得起这份荣耀。简洁易读，又不需要缩进，可以用在各种地方。但是只能用双引号的字符串，不能添加注释，不能多一个逗号都让这个格式显得又些“固执”。</p>
<h4 id="YAML的面面俱到"><a href="#YAML的面面俱到" class="headerlink" title="YAML的面面俱到"></a>YAML的面面俱到</h4><p>YAML真的很不错，基本上该有的都有，也修正了之前的格式的很多缺点。但是面面俱到有时候也会面面不到，很多时候看YAML这个基于缩进的格式会眼花。</p>
<h4 id="TOML的不知所措"><a href="#TOML的不知所措" class="headerlink" title="TOML的不知所措"></a>TOML的不知所措</h4><p>TOML也挺好，分区式的结构清晰明白，不需要缩进，有点回到INI格式的感觉。但是很多时候它的语法导致某些结构的写法增加许多不必要的东西。</p>
<h2 id="KSON的想法"><a href="#KSON的想法" class="headerlink" title="KSON的想法"></a>KSON的想法</h2><p>Kola Simple Object Notation.</p>
<p>基本就是在CSON的基础上进行了一点改进</p>
<ul>
<li>可以用<code>=</code>作为键值对分隔符</li>
<li>可以用<code>,</code>和<code>;</code>定义数组</li>
</ul>
<p>一个简单的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">name: &quot;name&quot;</span><br><span class="line">mode: &quot;MODE&quot;</span><br><span class="line">hash =</span><br><span class="line">  type = &apos;_&apos;</span><br><span class="line">  info = &apos;x&apos;</span><br><span class="line">  ex:</span><br><span class="line">    wow: `WOW`</span><br><span class="line">    lol: &apos;LOL&apos;</span><br><span class="line">list:</span><br><span class="line">  1</span><br><span class="line">  2</span><br><span class="line">,</span><br><span class="line">  field1: 10</span><br><span class="line">  field2: 20</span><br><span class="line">,  </span><br><span class="line">  field1: 100</span><br><span class="line">  field2: 200</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/27/Jolokiabeat-的设计思路/" itemprop="url">
                  Jolokiabeat 的设计思路
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-08-27T19:46:48-07:00" content="2016-08-27">
              2016-08-27
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>Jolokia真是个好东西，把本来只有JVM才能访问的JMX信息暴露成一个http服务，使得我们只需要操控REST API就能获得想要的效果。</p>
<p>Jolokiabeat是我在工作时遇到了需求打造的，基于elastic公司的libbeat，参考了influxdata家TICK技术栈中的Telegraf中jolokia插件的实现，并且借鉴了logstash的JMX插件的一些想法（比如模板化MBean名称提供更多的额外信息，简化查询规则等等）</p>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><p>整个程序和其他的beat系列程序一样，都采用了流水线形式的架构：</p>
<p>[JMX_collector] =&gt; [Metrics transformer] =&gt; [LibBeat.Dispatcher]</p>
<p>JMX_Collector负责从Jolokia服务中拉取metrics<br>Metrics transformer负责将取回的信息整理<br>LibBeat.Dispatcher就是将信息发送出去的机制</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>Jolokiabeat的alpha版本最初使用TOML作为JMX查询参数的配置文件，结果兜兜转转一大圈以后，发现还是TOML最符合要求（最完美的cson并没有golang的binding，残念）</p>
<p>除了TOML之外，JSON，YAML甚至CSON都曾经在我的考虑范围之内，但是首先JSON因为自身格式需要太多花括号而且其实不算太灵活（主要是我经常想写个注释防止自己忘记一些东西，但是JSON连最后一个逗号都不许你加，字符串只能双引号你还想双斜杠写注释？🙄）。</p>
<p>接下来的CSON其实是一个非常理想的格式，因为它就是一个可以写注释的JSON而且还有各种改进，但是无奈coffeescript自从ES6粉墨登场开始就在走下坡路，而且CSON的库也只有js的支持，所以只好作罢</p>
<p>YAML是个不错的语言，如果喜欢python那种缩进式语法的话，肯定能很喜欢<br><em>但是我从来就觉得python的缩进有时候真的是…………</em></p>
<p>尝试一下<a href="https://hjson.org" target="_blank" rel="noopener">hjson</a>格式之后（其实仔细看的话就会发现这货就是cson，而且没有hocon那么复杂，但是没有完美解决对象数组的格式嵌套），我还是乖乖地滚回到了TOML的怀抱…………</p>
<p>于是一个配置文件应该长这样：（每个配置都是以server&amp;context为单位的）<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[[jolokia]]</span></span><br><span class="line"><span class="attr">host</span> = <span class="string">"localhost"</span></span><br><span class="line"><span class="attr">port</span> = <span class="number">9999</span></span><br><span class="line"><span class="comment"># 用户名和密码</span></span><br><span class="line"><span class="comment">#username:</span></span><br><span class="line"><span class="comment">#password:</span></span><br><span class="line"><span class="comment">#还可以设置proxy代理服务器</span></span><br><span class="line"><span class="comment"># context一定不能少，而且不可以有/在里面</span></span><br><span class="line"><span class="attr">context</span> = <span class="string">"kafka"</span></span><br><span class="line"><span class="comment"># extra可以为beat提供额外的信息</span></span><br><span class="line"><span class="section">  [jolokia.extra]</span></span><br><span class="line">    type = "jolokia-beat"</span><br><span class="line">    measurement = "MessageQueue.Kafka"</span><br><span class="line"><span class="section">  [[jolokia.metrics]]</span></span><br><span class="line">    name = "server.ReplicaManager.$&#123;name&#125;"</span><br><span class="line">    bean = "kafka.server:name=*,type=ReplicaManager"</span><br><span class="line">    <span class="comment"># 作为标签添加的属性名</span></span><br><span class="line">    as_tag = ["type","name"]</span><br><span class="line"><span class="section">  [[jolokia.metrics]]</span></span><br><span class="line">    bean = "kafka.server:name=PartitionCount,type=ReplicaManager"</span><br></pre></td></tr></table></figure></p>
<h2 id="数据整合变形"><a href="#数据整合变形" class="headerlink" title="数据整合变形"></a>数据整合变形</h2><p>这是从jolokia返回的json：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"timestamp"</span>: <span class="number">1472159044</span>,</span><br><span class="line">    <span class="attr">"status"</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">"request"</span>: &#123;</span><br><span class="line">        <span class="attr">"mbean"</span>: <span class="string">"kafka.server:name=*,type=ReplicaManager"</span>,</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"read"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"value"</span>: &#123;</span><br><span class="line">        <span class="attr">"kafka.server:name=IsrShrinksPerSec,type=ReplicaManager"</span>: &#123;</span><br><span class="line">            <span class="attr">"OneMinuteRate"</span>: <span class="number">0.0</span>,</span><br><span class="line">            <span class="attr">"Count"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"RateUnit"</span>: <span class="string">"SECONDS"</span>,</span><br><span class="line">            <span class="attr">"MeanRate"</span>: <span class="number">0.0</span>,</span><br><span class="line">            <span class="attr">"FiveMinuteRate"</span>: <span class="number">0.0</span>,</span><br><span class="line">            <span class="attr">"EventType"</span>: <span class="string">"shrinks"</span>,</span><br><span class="line">            <span class="attr">"FifteenMinuteRate"</span>: <span class="number">0.0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"kafka.server:name=PartitionCount,type=ReplicaManager"</span>: &#123;</span><br><span class="line">            <span class="attr">"Value"</span>: <span class="number">72</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"kafka.server:name=IsrExpandsPerSec,type=ReplicaManager"</span>: &#123;</span><br><span class="line">            <span class="attr">"OneMinuteRate"</span>: <span class="number">0.0</span>,</span><br><span class="line">            <span class="attr">"Count"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"RateUnit"</span>: <span class="string">"SECONDS"</span>,</span><br><span class="line">            <span class="attr">"MeanRate"</span>: <span class="number">0.0</span>,</span><br><span class="line">            <span class="attr">"FiveMinuteRate"</span>: <span class="number">0.0</span>,</span><br><span class="line">            <span class="attr">"EventType"</span>: <span class="string">"expands"</span>,</span><br><span class="line">            <span class="attr">"FifteenMinuteRate"</span>: <span class="number">0.0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"kafka.server:name=UnderReplicatedPartitions,type=ReplicaManager"</span>: &#123;</span><br><span class="line">            <span class="attr">"Value"</span>: <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"kafka.server:name=LeaderCount,type=ReplicaManager"</span>: &#123;</span><br><span class="line">            <span class="attr">"Value"</span>: <span class="number">72</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这是在jason库帮助下进行了变形之后的数据：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">timestamp</span> <span class="string">:</span> <span class="number">1472159044</span></span><br><span class="line"><span class="string">status</span> <span class="string">:</span> <span class="number">200</span></span><br><span class="line"><span class="string">result</span> <span class="string">:</span></span><br><span class="line"><span class="attr">    - meta:</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">"IsrShrinksPerSec"</span></span><br><span class="line"><span class="attr">        type:</span> <span class="string">"ReplicaManager"</span></span><br><span class="line"><span class="attr">      data:</span></span><br><span class="line"><span class="attr">        OneMinuteRate:</span> <span class="number">0.0</span></span><br><span class="line"><span class="attr">        Count:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">        MeanRate:</span> <span class="number">0.0</span></span><br><span class="line"><span class="attr">        FiveMinuteRate:</span> <span class="number">0.0</span></span><br><span class="line"><span class="attr">        FifteenMinuteRate:</span> <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    - meta:</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">"PartitionCount"</span></span><br><span class="line"><span class="attr">        type:</span> <span class="string">"ReplicaManager"</span></span><br><span class="line"><span class="attr">      data:</span></span><br><span class="line"><span class="attr">        Value:</span> <span class="number">72</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    - meta:</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">"IsrExpandsPerSec"</span></span><br><span class="line"><span class="attr">        type:</span> <span class="string">"ReplicaManager"</span></span><br><span class="line"><span class="attr">      data:</span></span><br><span class="line"><span class="attr">        OneMinuteRate:</span> <span class="number">0.0</span></span><br><span class="line"><span class="attr">        Count:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">        MeanRate:</span> <span class="number">0.0</span></span><br><span class="line"><span class="attr">        FiveMinuteRate:</span> <span class="number">0.0</span></span><br><span class="line"><span class="attr">        FifteenMinuteRate:</span> <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    - meta:</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">"UnderReplicatedPartitions"</span></span><br><span class="line"><span class="attr">        type:</span> <span class="string">"ReplicaManager"</span></span><br><span class="line"><span class="attr">      data:</span></span><br><span class="line"><span class="attr">        Value:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    - meta:</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">"LeaderCount"</span></span><br><span class="line"><span class="attr">        type:</span> <span class="string">"ReplicaManager"</span></span><br><span class="line"><span class="attr">      data:</span></span><br><span class="line"><span class="attr">        Value:</span> <span class="number">72</span></span><br></pre></td></tr></table></figure>
<p>另一种情况就是没有使用*通配符的时候：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"timestamp"</span>: <span class="number">1472162915</span>,</span><br><span class="line">  <span class="attr">"status"</span>: <span class="number">200</span>,</span><br><span class="line">  <span class="attr">"request"</span>: &#123;</span><br><span class="line">    <span class="attr">"mbean"</span>: <span class="string">"kafka.server:name=PartitionCount,type=ReplicaManager"</span>,</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"read"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"value"</span>: &#123;</span><br><span class="line">    <span class="attr">"Value"</span>: <span class="number">72</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">timestamp</span> <span class="string">:</span> <span class="number">1472159044</span></span><br><span class="line"><span class="string">status</span> <span class="string">:</span> <span class="number">200</span></span><br><span class="line"><span class="string">result</span> <span class="string">:</span></span><br><span class="line"><span class="attr">    - meta:</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">"PartitionCount"</span></span><br><span class="line"><span class="attr">        type:</span> <span class="string">"ReplicaManager"</span></span><br><span class="line"><span class="attr">      data:</span></span><br><span class="line"><span class="attr">        Value:</span> <span class="number">72</span></span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"timestamp"</span>: <span class="number">1472167534</span>,</span><br><span class="line">  <span class="attr">"status"</span>: <span class="number">200</span>,</span><br><span class="line">  <span class="attr">"request"</span>: &#123;</span><br><span class="line">    <span class="attr">"mbean"</span>: <span class="string">"kafka.server:name=IsrExpandsPerSec,type=ReplicaManager"</span>,</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"read"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"value"</span>: &#123;</span><br><span class="line">    <span class="attr">"OneMinuteRate"</span>: <span class="number">0.0</span>,</span><br><span class="line">    <span class="attr">"Count"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"RateUnit"</span>: <span class="string">"SECONDS"</span>,</span><br><span class="line">    <span class="attr">"MeanRate"</span>: <span class="number">0.0</span>,</span><br><span class="line">    <span class="attr">"FiveMinuteRate"</span>: <span class="number">0.0</span>,</span><br><span class="line">    <span class="attr">"EventType"</span>: <span class="string">"expands"</span>,</span><br><span class="line">    <span class="attr">"FifteenMinuteRate"</span>: <span class="number">0.0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">timestamp</span> <span class="string">:</span> <span class="number">1472167534</span></span><br><span class="line"><span class="string">status</span> <span class="string">:</span> <span class="number">200</span></span><br><span class="line"><span class="attr">result:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">meta</span> <span class="string">:</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">"IsrExpandsPerSec"</span></span><br><span class="line"><span class="attr">        type:</span> <span class="string">"ReplicaManager"</span></span><br><span class="line"><span class="attr">      data:</span></span><br><span class="line"><span class="attr">        OneMinuteRate:</span> <span class="number">0.0</span></span><br><span class="line"><span class="attr">        Count:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">        MeanRate:</span> <span class="number">0.0</span></span><br><span class="line"><span class="attr">        FiveMinuteRate:</span> <span class="number">0.0</span></span><br><span class="line"><span class="attr">        FifteenMinuteRate:</span> <span class="number">0.0</span></span><br></pre></td></tr></table></figure>
<p>TBC，未完待续……</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/27/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-08-27T14:32:20-07:00" content="2016-08-27">
              2016-08-27
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>你正在看星空航行家的旅行日志，关于时间，世界，欢乐和感悟的一本志。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/27/让我们多多利用git来方便管理hexo吧/" itemprop="url">
                  让我们多多利用git来方便管理hexo吧
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-08-27T13:39:46-07:00" content="2016-08-27">
              2016-08-27
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文的命令的idea都来自于<a href="http://www.craigjperry.com/hexo-with-github-pages.html" target="_blank" rel="noopener">http://www.craigjperry.com/hexo-with-github-pages.html</a></p>
<h2 id="创建本地Hexo目录"><a href="#创建本地Hexo目录" class="headerlink" title="创建本地Hexo目录"></a>创建本地Hexo目录</h2><p>现在的hexo版本又一个问题，就是如果先<code>git init</code>再<code>hexo init</code>的话，回导致<code>.git</code>目录被删除，所以解决方案就是：</p>
<p>——把两者的顺序换一下！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo -g <span class="comment">#先安装hexo命令行工具</span></span><br><span class="line">$ hexo init <span class="comment">#吃我大init辣</span></span><br><span class="line">$ npm install <span class="comment">#快使用npm</span></span><br><span class="line">$ hexo s <span class="comment">#先看看能不能冒烟</span></span><br></pre></td></tr></table></figure>
<p>至此hexo目录应该就已经成功设置了，这里插播一下<code>.gitignore</code>文件，用<a href="https://www.gitignore.io/api/node" target="_blank" rel="noopener">https://www.gitignore.io/api/node</a> 这里的内容，可以解决大多数问题</p>
<p>接下来我们一套标jŭn的<code>git init</code>流程走一遍就可以了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git init</span><br><span class="line">$ git add .</span><br><span class="line">$ git commit -m <span class="string">'Initial commit'</span></span><br></pre></td></tr></table></figure>
<h2 id="创建一个Git仓库"><a href="#创建一个Git仓库" class="headerlink" title="创建一个Git仓库"></a>创建一个Git仓库</h2><ol>
<li><p>在github网站上创建一个同名的空仓库：<your-user-name>.github.io</your-user-name></p>
</li>
<li><p>将本地hexo目录的remote指向这个仓库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add origin &lt;remote repo URL&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后在本地创建一个orphan分支（这个中文应该怎么叫？孤立分支？）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout --orphan meta-content <span class="comment">#创建孤立分支</span></span><br><span class="line">$ git push -u origin meta-content <span class="comment">#不要忘记顺便推送一下</span></span><br><span class="line">$ git checkout master <span class="comment">#记得切换回master</span></span><br><span class="line">$ git rm -rf * <span class="comment">#清除master里面的内容</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="配置git部署工具"><a href="#配置git部署工具" class="headerlink" title="配置git部署工具"></a>配置git部署工具</h2><p><em>首先确定从ssh密钥可以正常工作</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>
<p>编辑_config.yml文件，修改里面的deploy字段：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">git</span></span><br><span class="line"><span class="attr">  repo:</span> <span class="attr">ssh://git@github.com/&lt;Your-Github-Username&gt;/&lt;your-github-username&gt;.github.io</span></span><br><span class="line"><span class="attr">  branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>
<p>然后我们就可以</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>轻松走上hexo写作之路！</p>
<h3 id="正确的创建新文章的姿势"><a href="#正确的创建新文章的姿势" class="headerlink" title="正确的创建新文章的姿势"></a>正确的创建新文章的姿势</h3><ol>
<li><p>首先确定我们所在的分支：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch</span><br></pre></td></tr></table></figure>
<p>应该是<code>meta-content</code></p>
</li>
<li><p>然后就是一套组合拳：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b my-next-post-topic</span><br><span class="line">$ hexo new post <span class="string">"My Next Post Topic"</span></span><br><span class="line">$ git add .</span><br><span class="line">$ git commit -m <span class="string">"started new topic"</span></span><br><span class="line">$ git push -u origin my-next-post-topic</span><br></pre></td></tr></table></figure>
</li>
<li><p>当我们确认写好这篇文章以后，再把这个分支合并回<code>meta-content</code>去，最后再运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>这个办法的好处就是将github既当成离线备份，也当成同步机制，岂不美哉？</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars1.githubusercontent.com/u/2584204?v=3&s=460"
               alt="Kirkonväki" />
          <p class="site-author-name" itemprop="name">Kirkonväki</p>
          <p class="site-description motion-element" itemprop="description">现在立刻马上！</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">8</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">15</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kirkonväki</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
